<!DOCTYPE html>
<html>
    <head>
        <title>IoT Surface LDR</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.5.0/semantic.min.css" integrity="sha512-KXol4x3sVoO+8ZsWPFI/r5KBVB/ssCGB5tsv2nVOKwLg33wTFP3fmnXa47FdSVIshVTgsYk/1734xSk9aFIa4A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
    </head>
    <body>
        <div class="ui container" style="margin: 1rem">
            <h1>IoT Surface LDR Dashboard</h1>
            <div id="measureOutput" style="width: 100px; height: 100px"></div>
            <button id="measureButton" class="ui fluid button primary" style="margin: 1rem" onclick="measure()">Start Measurement</button>
            <canvas id="historyChart"></canvas>
        </div>
        <script>
            const createDataset = (name, color) => {
                return {
                    label: name,
                    data: [],
                    borderColor: color,
                };
            };

            const context = document.getElementById("historyChart");
            let labels = [];
            let redDataset = createDataset("Red", "rgb(255, 0, 0)");
            let greenDataset = createDataset("Green", "rgb(0, 255, 0)");
            let blueDataset = createDataset("Blue", "rgb(0, 0, 255)");

            const chart = new Chart(context, {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [
                        redDataset,
                        greenDataset,
                        blueDataset,
                    ]
                },
            });

            const measure = () => {
                document.getElementById("measureButton").disabled = true;
                fetch("http://172.20.10.8/measure")
                    .then(r => r.text())
                    .then(colors => {
                        const actualColors = colors.split(", ");
                        chart.data.datasets[0].data.push(actualColors[0]);
                        chart.data.datasets[1].data.push(actualColors[1]);
                        chart.data.datasets[2].data.push(actualColors[2]);
                        chart.data.labels.push("I");
                        chart.update();

                        document.getElementById("measureButton").disabled = false;
                        document.getElementById("measureOutput").style.backgroundColor = `rgb(${colors})`;
                    });
            };
        </script>
    </body>
</html>